<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Texet</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/xterm@3.8.0/dist/xterm.css"
    />
  </head>
  <body style="height: 100vh; padding: 0; margin: 0">
    <div style="display: flex; height: 50%">
      <div id="editor" style="width: 50%; border: 1px solid grey"></div>
      <div id="viewer" style="width: 50%">
        <canvas id="canvas"></canvas>
      </div>
    </div>
    <div style="display: flex; flex-direction: column; height: 50%">
      <div id="terminal" style="width: 100%; height: 70%"></div>
      <textarea
        name="status"
        id="status"
        cols="1"
        rows="1"
        style="
          width: 100%;
          height: 30%;
          padding: 5px;
          margin: 0;
          resize: none;
          box-sizing: border-box;
        "
      ></textarea>
    </div>

    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script src="https://mozilla.github.io/pdf.js/build/pdf.worker.js"></script>
    <script>
      const pdfData = atob(
        'JVBERi0xLjcKCjEgMCBvYmogICUgZW50cnkgcG9pbnQKPDwKICAvVHlwZSAvQ2F0YWxvZwog' +
          'IC9QYWdlcyAyIDAgUgo+PgplbmRvYmoKCjIgMCBvYmoKPDwKICAvVHlwZSAvUGFnZXMKICAv' +
          'TWVkaWFCb3ggWyAwIDAgMjAwIDIwMCBdCiAgL0NvdW50IDEKICAvS2lkcyBbIDMgMCBSIF0K' +
          'Pj4KZW5kb2JqCgozIDAgb2JqCjw8CiAgL1R5cGUgL1BhZ2UKICAvUGFyZW50IDIgMCBSCiAg' +
          'L1Jlc291cmNlcyA8PAogICAgL0ZvbnQgPDwKICAgICAgL0YxIDQgMCBSIAogICAgPj4KICA+' +
          'PgogIC9Db250ZW50cyA1IDAgUgo+PgplbmRvYmoKCjQgMCBvYmoKPDwKICAvVHlwZSAvRm9u' +
          'dAogIC9TdWJ0eXBlIC9UeXBlMQogIC9CYXNlRm9udCAvVGltZXMtUm9tYW4KPj4KZW5kb2Jq' +
          'Cgo1IDAgb2JqICAlIHBhZ2UgY29udGVudAo8PAogIC9MZW5ndGggNDQKPj4Kc3RyZWFtCkJU' +
          'CjcwIDUwIFRECi9GMSAxMiBUZgooSGVsbG8sIHdvcmxkISkgVGoKRVQKZW5kc3RyZWFtCmVu' +
          'ZG9iagoKeHJlZgowIDYKMDAwMDAwMDAwMCA2NTUzNSBmIAowMDAwMDAwMDEwIDAwMDAwIG4g' +
          'CjAwMDAwMDAwNzkgMDAwMDAgbiAKMDAwMDAwMDE3MyAwMDAwMCBuIAowMDAwMDAwMzAxIDAw' +
          'MDAwIG4gCjAwMDAwMDAzODAgMDAwMDAgbiAKdHJhaWxlcgo8PAogIC9TaXplIDYKICAvUm9v' +
          'dCAxIDAgUgo+PgpzdGFydHhyZWYKNDkyCiUlRU9G'
      )

      require.config({
        paths: {
          vs: 'https://unpkg.com/monaco-editor@latest/min/vs',
          xterm: 'https://unpkg.com/xterm@3.8.0/dist'
        }
      })

      // Before loading vs/editor/editor.main, define a global MonacoEnvironment that overwrites
      // the default worker url location (used when creating WebWorkers). The problem here is that
      // HTML5 does not allow cross-domain web workers, so we need to proxy the instantiation of
      // a web worker through a same-domain script
      window.MonacoEnvironment = {
        getWorkerUrl: function (workerId, label) {
          return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
              self.MonacoEnvironment = {
                baseUrl: 'https://unpkg.com/monaco-editor@latest/min/'
              };
              importScripts('https://unpkg.com/monaco-editor@latest/min/vs/base/worker/workerMain.js');`)}`
        }
      }

      require([
        'vs/editor/editor.main',
        'xterm/xterm',
        'xterm/addons/fit/fit',
        'pdfjs-dist/build/pdf'
      ], async function (editor, Terminal, fit, pdfjsLib) {
        let myeditor = editor.editor.create(document.getElementById('editor'), {
          theme: 'vs-dark'
        })

        Terminal.applyAddon(fit)
        let xterm = new Terminal()
        xterm.open(document.getElementById('terminal'))
        xterm.write('Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ')

        pdfjsLib.GlobalWorkerOptions.workerSrc =
          '//mozilla.github.io/pdf.js/build/pdf.worker.js'

        let pdf = await pdfjsLib.getDocument({ data: pdfData }).promise
        let page = await pdf.getPage(1)

        const scale = 1.5
        let viewport = page.getViewport({ scale: scale })
        let canvas = document.getElementById('canvas')
        let context = canvas.getContext('2d')
        canvas.height = viewport.height
        canvas.width = viewport.width

        var renderContext = {
          canvasContext: context,
          viewport: viewport
        }

        await page.render(renderContext).promise
        console.log('Page rendered')

        myeditor.layout()
        xterm.fit()

        window.onresize = () => {
          myeditor.layout()
          xterm.fit()

          console.log('resized')
        }
      })
    </script>
  </body>
</html>
